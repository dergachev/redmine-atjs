<html>
  <head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script src="vendor/markleteer.js"></script>
  </head>
<body>

<h1>Redmine-Ref Bookmarklet</h1>

<textarea class="bookmarklet" title="Redmine-Ref-localhost">
// use with http://dergachev.github.io/markleteer/
(function(){
    var done = false;
    var script = document.createElement("script");
    script.src = "//cdnjs.cloudflare.com/ajax/libs/yepnope/1.5.4/yepnope.min.js";
    script.onload = script.onreadystatechange = function(){
      if (!done && (!this.readyState || this.readyState == "loaded" || this.readyState == "complete")) {
        done = true;
        requireDeps();
      }
    };
    document.getElementsByTagName("head")[0].appendChild(script);
})();

function requireDeps() {
  //TODO: reverse yep / nope logic to be consistent with standard usage;
  yepnope([{
      test: typeof(window.jQuery) === 'undefined' || jQuery.fn.jquery.match(/^1\.[0-9]+/) < 1.7,
      yep: '//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.0/jquery.min.js'
    },
    { test: typeof(window.jQuery) === 'undefined' || typeof(window.jQuery.fn.atwho) === 'undefined',
      yep: ['https://localhost:4443/vendor/jquery.atwho.js','https://localhost:4443/vendor/jquery.atwho.css']
    },
    { 
      load: ['https://localhost:4443/redmine-atjs.js'],
    }
  ]);
}
</textarea>
</body>
</html>
